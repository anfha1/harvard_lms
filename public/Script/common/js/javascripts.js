Common=function(){return this.AddCustomValidation(),this.Init()};Common.prototype={Init:function(){$(document).ready(function(){$(".main-sidebar").unbind("mouseenter mouseleave");String.prototype.format=function(){var n=this,t,r;for(i=0;i<arguments.length;i++)t=arguments[i],r=new RegExp("{["+i+"]}","g"),n=n.replace(r,t);return n};$(window).scroll(function(){$(window).scrollTop()>350?$("#footer-container-move").show():$("#footer-container-move").hide()});$("body").on("hidden.bs.modal",function(){$("div.modal:visible").length&&$(this).addClass("modal-open")})})},InitializeForm:function(n){var t=this;$(n).data("user-guide")==!0&&($(n).find("input,select").attr("title","Sử dụng chuột phải để xóa"),$(n).find(".action-popup .glyphicon-plus-sign").attr("title","Thêm"),$(n).find(".action-popup .glyphicon-minus-sign").attr("title","Xóa những trường đã chọn"));$(n).find("input,select").bind("contextmenu",function(){return $(this).val(""),!1});$(n).find("input[data-val-date]").datepicker({dateFormat:$.datepicker._defaults.dateFormat,onSelect:function(){var n=$(this).closest("form").validate();n.element($(this))}});$(n).find("input[data-val-date]").attr("readonly");$(n).find("select[data-popup]").each(function(){$(this).parent().find(".action-popup .glyphicon").data("element",this);$(this).parent().find(".action-popup .glyphicon-plus-sign").unbind("click").click(function(){var n=$(this).data("element"),i;Common.empty($(n).attr("disabled"))&&(i=$(n).data("popup"),Common.ShowPopup({Url:t.Url.PopupSearchDialog+"/"+i,CallBack:function(t){var r=[],u,i;for(u in t)i=t[u],$(n).find("option[value='"+i.Id+"']").length==0&&r.push(Common.BindHtml("<option value='#Id' selected>#Name<\/option>",i));$(n).html($(n).html()+r.join(""));$(n).change()}}))});$(this).parent().find(".action-popup .glyphicon-minus-sign").unbind("click").click(function(){var n=$(this).data("element"),t;Common.empty($(n).attr("disabled"))&&(t=$(n).find("option:selected"),t.remove(),$(n).change())})});this.RebindValidate(n)},RebindValidate:function(n){var t=$(n);t.length>0&&(t.unbind(),t.data("validator",null),$.validator.unobtrusive.parse(t),t.validate(t.data("unobtrusiveValidation").options),t.data("validate-tooltip")==!0&&this.EnableValidateToolTip(t))},Keys:{8:!0,35:!0,36:!0,37:!0,39:!0},ValidateDecimalTrueMinus:function(n,t){var i=n.charCode||n.keyCode||n.which,r;i>=48&&i<=57||i==45?(r=$(t).val(),r.indexOf("-")!=-1&&i==45&&n.preventDefault()):Common.Empty(String.fromCharCode(i))||Common.Keys[i]||n.preventDefault()},ValidateDecimal:function(n,t){var i=n.charCode||n.keyCode||n.which,r;i>=48&&i<=57||i==13?r=$(t).val():n.preventDefault()},ValidateDecimalAllowPoint:function(n,t){var i=n.charCode||n.keyCode||n.which,r;i>=48&&i<=57?r=$(t).val():i==46?(Common.Empty($(t).val())||$(t).val().indexOf(".")!=-1)&&n.preventDefault():Common.Empty(String.fromCharCode(i))||Common.Keys[i]||n.preventDefault()},ValidateInteger:function(n){var t=n.charCode||n.keyCode||n.which;t<48&&t>57&&(Common.Empty(String.fromCharCode(t))||Common.Keys[t]||n.preventDefault())},AddCustomValidation:function(){$.datepicker.setDefaults({dateFormat:"dd/mm/yy"})},ShowForm:function(n){var t=this;Common.Empty(this.LoadingPages)&&(this.LoadingPages={});Common.Empty(this.LoadingPages[n.url])&&(this.LoadingPages[n.url]=!0,Common.ShowLoading(!0),$.ajax({url:n.url,data:n.data,complete:function(){setTimeout(function(){delete t.LoadingPages[n.url]},1e3)},success:function(t){$(n.element).html(t);n.callback!=undefined&&typeof n.callback=="function"&&n.callback()}}))},Empty:function(n){return n==null||n==undefined||n==""||n.length==0||jQuery.trim(n).length==0?!0:!1},Serialize:function(n){var t=$(n).serialize();return t||(t=$(n).find("input[name],select[name],textarea[name]").serialize()),t},ShowLoading:function(n){n?$(".loading").show():$(".loading").hide()},GetDateFormat:function(n){return $.datepicker.formatDate($.datepicker._defaults.dateFormat,n)},DisableButton:function(n,t){t?$(n).prop("disabled",!0):$(n).prop("disabled",!1)},ShowAlert:function(n,t,i,r,u){function f(){$(target).find(".modal-footer .btn").hide()}function e(n){var i=$(target).find(".modal-footer"),e,t,r,u,f;if($(i).find(".new-btn").remove(),n.Close!=undefined&&(n.Close.Display?$(i).find(".btn-close").show():$(i).find(".btn-close").hide(),n.Close.OnClick&&$(i).find(".btn-close").click(function(t,i){n.Close.OnClick(t,i)})),!Common.Empty(n.Items))for(e in n.Items)(t=n.Items[e],t.Name!=undefined)&&(r="",u="",t.Class==undefined?r="btn-primary":Common.Empty(t.Class)||(r=t.Class),t.DataDismiss==undefined?u="":Common.Empty(t.DataDismiss)||(u=t.DataDismiss),$(i).prepend('<button type="button" class="btn btn-sm '+r+" new-btn btn-"+t.Name+'" '+u+" ><\/button"),f=$(i).find(".new-btn.btn-"+t.Name),t.Value!=undefined&&f.html(t.Value),$(f).data("this",t),t.OnClick!=undefined&&f.click(t.OnClick))}function o(n){$(target).unbind("shown.bs.modal").off("shown.bs.modal").on("shown.bs.modal",function(){$(target).off("shown.bs.modal");$(".btn-"+n).focus()})}if(target=$("#modal-alert"),$(target).find(".modal-title").html(n),$(target).find(".modal-body").html(t),f(),i==undefined?$(target).find(".modal-footer .btn-close").show():e(i),typeof r!="undefined"&&o(r),u!="undefined")$(target).unbind("hidden.bs.modal").off("hidden.bs.modal").on("hidden.bs.modal",function(){$(target).off("hidden.bs.modal");try{u()}catch(n){}});$(target).modal("show");Common.ShowLoading(!1)},HideAlert:function(n){target=$("#modal-alert");target.modal("hide");$(target).unbind("hidden.bs.modal").off("hidden.bs.modal").on("hidden.bs.modal",function(){$(target).off("hidden.bs.modal");typeof n=="function"&&n()})},ShowPopup:function(n){var f=this,i,t,r,u;Common.Empty(n)||($('<div class="modal-backdrop fade in"><\/div>').appendTo(document.body),i=Common.Empty(n.Data)?"":"?"+$.param(n.Data,!0),t=window.open(n.Url+i,"","width=1024,height=600,directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=yes,resizable=yes"),$(t).focusout(function(){alert("abc")}),r=t.attachEvent||t.addEventListener,u=t.attachEvent?"onbeforeunload":"beforeunload",$(".modal-backdrop").unbind("click").click(function(){t.focus()}),r(u,function(){$(".modal-backdrop").unbind("click");$(".modal-backdrop").remove();typeof n.CallBack=="function"&&n.CallBack(this.Response)}))},LoadingCount:0,Ajax:function(n,t){var i=Common.getCookie("Branch");return Common.Empty($("#select-branch"))||$("#select-branch").val()==i||window.location.reload(),Common.ShowLoading(!0),Common.LoadingCount++,n=$.extend({type:"POST",async:!0,cache:!1,dataType:"json"},n),$.ajax(n).done(function(data,textStatus,jqXHR){typeof data=="string"&&data.indexOf("Common.RedirectLoginUrl")==0?eval(data):t(data)}).error(function(n,t,i){if(n.responseJSON)switch(n.responseJSON.errorCode){case"403":alert(n.responseJSON.errorMessage);window&&window.location&&(window.location.href="/");break;case"500":alert(n);alert(t);alert(i);break;default:alert(n.responseJSON.errorMessage)}}).always(function(){Common.LoadingCount--;Common.LoadingCount==0?Common.ShowLoading(!1):Common.ShowLoading(!0)})},AjaxNoLoading:function(n,t){var i=Common.getCookie("Branch");return Common.Empty($("#select-branch"))||$("#select-branch").val()==i||window.location.reload(),Common.ShowLoading(!1),Common.LoadingCount++,n=$.extend({type:"POST",async:!0,cache:!1,dataType:"json"},n),$.ajax(n).done(function(data,textStatus,jqXHR){typeof data=="string"&&data.indexOf("Common.RedirectLoginUrl")==0?eval(data):t(data)}).error(function(n,t,i){if(n.responseJSON)switch(n.responseJSON.errorCode){case"403":alert(n.responseJSON.errorMessage);window&&window.location&&(window.location.href="/");break;case"500":alert(n);alert(t);alert(i);break;default:alert(n.responseJSON.errorMessage)}}).always(function(){Common.LoadingCount--;Common.LoadingCount==0?Common.ShowLoading(!1):Common.ShowLoading(!0)})},ReplaceFormatCurrency:function(n){if(!Common.Empty(n)){var t=n.toString(),i=",";if(t.indexOf(i)>=0)return t.replace(new RegExp(i,"g"),"")}return n},FormatCurrency:function(n){var r;if(!Common.Empty(n)&&n!=null){n=Common.ReplaceFormatCurrency(n);var t=n,u=[],i="",f="";for(t.indexOf(".")>0&&(u=t.split("."),t=u[0]),t.indexOf("-")!=-1&&(f=t.substr(0,1),t=t.substr(1)),r=t.length;r>3;)i=","+t.substr(r-3,3)+i,r-=3;return i=t.substr(0,r)+i,f+i+(u.length==2?"."+u[1]:"")}return n},CheckPopupBlocked:function(n){setTimeout(function(){Common.DoCheckPopupBlocked(n)},500)},DoCheckPopupBlocked:function(n){var t=!1;try{t=typeof n=="undefined"?!0:n&&n.closed?!1:n&&n.outerWidth==0?!0:n&&n.test?!1:!0}catch(i){}t&&(Common.ShowAlert("Thông Báo","Chức năng in không thể thực hiện do trình duyệt không cho phép hiển thị Popup. Hãy cho phép hiển thị Popup để sử dụng chức năng này.",{Close:{Display:!1},Items:{Yes:{Name:"Close",Data:$(this),OnClick:function(){Common.HideAlert();$(".modal-backdrop").unbind("click");$(".modal-backdrop").remove()},Value:"Đóng"}}}),window.setTimeout(function(){$("#modal-alert").find(".close-modal.btn-Close").focus()},500))},AddZero:function(n){return n<10&&(n="0"+n),n},NewGuild:function(){var n=(new Date).getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){var i=(n+Math.random()*16)%16|0;return n=Math.floor(n/16),(t=="x"?i:i&7|8).toString(16)})},getCookie:function(n){for(var r=n+"=",u=document.cookie.split(";"),t,i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1);if(t.indexOf(r)==0)return t.substring(r.length,t.length)}return""},setCookie:function(n,t,i){var r=new Date,u;r.setTime(r.getTime()+i*864e5);u="expires="+r.toUTCString();document.cookie=n+"="+t+"; "+u},dateTimeReviver:function(n,t){var r,i;return typeof t=="string"&&(r=/\/Date\((\d*)\)\//.exec(t),r)?(i=new Date(+r[1]),i.getMonth()+1+"/"+i.getDate()+"/"+i.getFullYear()):t},SetFocusPosition:function(n){var t=n.val().length;n.focus();n[0].setSelectionRange(t,t);n.select()},ParseDate:function(n,t){return $.datepicker.parseDate(n,t)},CalcuDate:function(n,t){var i={},r=t.getTime()-n.getTime();return i.days=Math.floor(r/864e5),r-=i.days*864e5,i.hours=Math.floor(r/36e5),r-=i.hours*36e5,i.mins=Math.floor(r/6e4),r-=i.mins*6e4,i.seconds=Math.floor(r/1e3),r-=i.seconds*1e3,i},RedirectLoginUrl:function(n){window.location=n},ReadCookie:function(n){for(var r=n+"=",u=document.cookie.split(";"),t,i=0;i<u.length;i++){for(t=u[i];t.charAt(0)==" ";)t=t.substring(1,t.length);if(t.indexOf(r)==0)return t.substring(r.length,t.length).toString()}return null},CheckInputDate:function(n){var i=new Date,r,u,f,t;if(i.setHours(0),i.setMilliseconds(0),i.setMinutes(0),i.setSeconds(0),r=i.getDate().toString(),r=r.length>1?r:"0"+r,u=i.getMonth()+1,u=u.toString().length>1?u:"0"+u,f=$(n).val(),f.match(/^(0?[1-9]|[12][0-9]|3[01])[/-](0?[1-9]|1[0-2])[/-]\d\d\d\d$/)){if(t=f.split("/"),this.GetDaysInMonth(t[1],t[2])<parseInt(t[0],10))return Common.ShowAlert("Alert","The_days_in_month_incorrect"),$(n).val(r+"/"+u+"/"+i.getFullYear());t[0]>0&&t[0]<10&&t[0].length==1?f=t[1]!=10&&t[1]!=11&&t[1]!=12&&t[1].length==1?$(n).val("0"+t[0]+"/0"+t[1]+"/"+t[2]):$(n).val("0"+t[0]+"/"+t[1]+"/"+t[2]):t[1]!=10&&t[1]!=11&&t[1]!=12&&t[1].length==1&&(f=$(n).val(t[0]+"/0"+t[1]+"/"+t[2]));f=new Date(t[2],t[1]-1,t[0])}else return Common.ShowAlert("Alert","Date_not_format"),$(n).datepicker("update",i),$(n).val(r+"/"+u+"/"+i.getFullYear())},GetDaysInMonth:function(n,t){return new Date(t,n,0).getDate()},OnKeyDownEnterKey:function(){var t=$("#enterKey").val(),i=t.length,n=String($("#enterKey").val());switch(i){case 4:$("#enterKey").val(n.toString()+"-");break;case 9:$("#enterKey").val(n.toString()+"-");break;case 14:$("#enterKey").val(n.toString()+"-")}},RefreshCSS_Script:function(){var i,t;let n=document.getElementsByTagName("link");for(let t=0;t<n.length;t++)if(n[t].getAttribute("rel")=="stylesheet"){let i=n[t].getAttribute("href").split("?")[0],r=i+"?version="+(new Date).getMilliseconds();n[t].setAttribute("href",r)}i=(new Date).getTime();let r=document.getElementsByTagName("script");for(let n=0;n<r.length;n++)t=r[n],t.type="text/javascript",t.src="/myProduct/scripts/myUpdates.js?v="+i,document.body.appendChild(t)},GetDropdownListByValue:function(n,t,i,r){var u=$("#"+n).val();Common.Ajax({type:"POST",url:i,cache:!1,dataType:"json",data:{value:u}},function(n){var i=$("#"+t);i.empty();i.append($("<option/>",{value:0,text:r?r:"==tất cả=="}));$.each(n,function(n,t){i.append($("<option/>",{value:t.Value,text:t.Text}))})})},CopyToClipboard:function(n){var t=document.createElement("textarea");document.body.appendChild(t);t.value=n;t.select();document.execCommand("copy");document.body.removeChild(t)},DisableRightClickTag:function(n){$(n).bind("contextmenu",function(){return!1})},DisableShowInspect:function(){$(document).keydown(function(n){return n.keyCode==123?!1:n.ctrlKey&&n.shiftKey&&n.keyCode==73?!1:void 0})},updateImagePageClass:function(){var n=window.navigator.userAgent;(n.match(/Chrome/i)||n.match(/Firefox/i))&&$(".img-page").css({"image-rendering":"auto"})},CheckCommingSoonBeforeRedirect:function(n,t){$.ajax({url:"/Base/CheckIsCommingSoonApp",type:"post",data:{IdTheme:n},success:function(n){if(n==!0){Common.ShowAlert(resourcesAlert.titleInform,resourcesAlert.contentComingSoon);return}window.open(t)},error:function(n,t,i){console.log(t,i)}})}};this.Common=window.Common=new Common